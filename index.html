<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSync</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 15px;
            background-color: #f0f4ff;
            color: #4a5568;
            position: relative;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        h1 {
            text-align: center;
            color: #2b6cb0;
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        h1 i {
            color: #2b6cb0;
        }
        .card {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        .input-group {
            flex: 1 1 calc(50% - 7.5px);
            min-width: 0;
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            color: #1a365d;
            font-size: 0.95em;
            margin-bottom: 5px;
        }
        .description {
            font-size: 0.75em;
            color: #718096;
            font-style: italic;
            margin-top: 3px;
        }
        input, select {
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9em;
            background-color: #edf2f7;
            color: #2d3748;
            transition: border-color 0.3s ease;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #4a90e2;
        }
        input::placeholder {
            color: #a0aec0;
            opacity: 0.7;
        }
        button {
            background: linear-gradient(to right, #4a90e2, #63b3ed);
            color: white;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background 0.2s;
            width: 100%;
        }
        button:hover {
            background: linear-gradient(to right, #357abd, #4299e1);
        }
        button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        .results-section {
            margin-top: 15px;
            display: none;
        }
        .result-card {
            background-color: #f8fafc;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            margin-bottom: 10px;
        }
        .chart-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 15px;
            padding: 5px;
        }
        .chart {
            border: 1px solid #000;
            border-radius: 5px;
            background-color: #ffffff;
            width: 280px;
            height: 300px;
            position: relative;
            overflow: hidden;
            flex: 1 1 280px;
        }
        .chart .chart-title {
            font-size: 12px;
            font-weight: 600;
            color: #2b6cb0;
            text-align: center;
            padding: 3px 0;
            background-color: #f8fafc;
            border-bottom: 1px solid #000;
        }
        .chart svg {
            width: 100%;
            height: 270px;
            padding: 5px;
        }
        .chart legend {
            font-size: 9px;
            color: #4a5568;
            margin-top: 3px;
            text-align: center;
        }
        .error {
            color: #e53e3e;
            font-size: 0.9em;
            text-align: center;
            margin-top: 10px;
        }
        .about-section {
            background-color: #e6fffa;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
        }
        .example {
            background-color: #fffaf0;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #e6e0d4;
            margin-top: 8px;
        }
        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(to right, #4a90e2, #63b3ed);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, background 0.2s;
        }
        .chatbot-toggle:hover {
            background: linear-gradient(to right, #357abd, #4299e1);
            transform: scale(1.1);
        }
        .chatbot-toggle i {
            margin: 0;
        }
        .chatbot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .chatbot-content {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            position: relative;
            opacity: 0;
            animation: fadeIn 0.3s ease-in forwards;
            background: linear-gradient(135deg, #f0f4ff, #e6fffa);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .chatbot-content h2 {
            color: #2b6cb0;
            font-size: 1.2em;
            text-align: center;
            margin-bottom: 10px;
        }
        .chatbot-message {
            margin: 10px 0;
            padding: 8px;
            background-color: #edf2f7;
            border-radius: 6px;
            color: #1a365d;
        }
        .chatbot-input {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .chatbot-input button {
            flex: 1;
            padding: 8px;
            min-width: 100px;
            width: auto;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5em;
            color: #4a5568;
            cursor: pointer;
        }
        .success-message {
            display: none;
            background-color: #e6fffa;
            color: #2b6cb0;
            font-size: 1.4em;
            font-weight: 600;
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            margin: 10px auto;
            max-width: 500px;
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 900px) {
            body {
                padding: 10px;
                max-width: 100%;
            }
            h1 {
                font-size: 1.8em;
            }
            .input-section {
                flex-direction: column;
            }
            .input-group {
                flex: 1 1 100%;
            }
            .card {
                padding: 10px;
            }
            button {
                padding: 8px;
            }
            .success-message {
                font-size: 1.1em;
                padding: 8px;
            }
            .chatbot-content {
                width: 95%;
                padding: 10px;
            }
            .chatbot-toggle {
                bottom: 10px;
                right: 10px;
                width: 50px;
                height: 50px;
                font-size: 1.2em;
            }
            .chart {
                width: 100%;
                height: 280px;
            }
            .chart .chart-title {
                font-size: 11px;
            }
            .chart svg {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-sync-alt"></i> StockSync</h1>
        <div class="about-section">
            <p>Get smart inventory insights for multiple products with easy-to-understand visuals.</p>
        </div>
        <div class="card">
            <h2>Data Input</h2>
            <div class="input-section">
                <div class="input-group">
                    <label for="uploadSales">Upload Sales Sheet</label>
                    <input type="file" id="uploadSales" accept=".csv" onchange="checkInputs()">
                    <p class="description">CSV with: stock_id, product_name, sales_amount, sales_date (max 1000 records).</p>
                </div>
                <div class="input-group">
                    <label for="uploadPurchases">Upload Purchase Sheet</label>
                    <input type="file" id="uploadPurchases" accept=".csv" onchange="checkInputs()">
                    <p class="description">CSV with: stock_id, product_name, purchase_amount, purchase_date (max 1000 records).</p>
                </div>
                <div class="input-group">
                    <label for="service_reliability">Service Reliability</label>
                    <select id="service_reliability" onchange="checkInputs()">
                        <option value="1.65">Very High (95%)</option>
                        <option value="1.28" selected>High (90%)</option>
                        <option value="0.84">Moderate (80%)</option>
                    </select>
                    <p class="description">Select how reliably you want to maintain stock.</p>
                </div>
                <div class="input-group">
                    <label for="annual_operating_days">Annual Operating Days</label>
                    <input type="number" id="annual_operating_days" placeholder="e.g., 365" step="any" onchange="checkInputs()">
                    <p class="description">Enter the number of days you operate annually.</p>
                </div>
            </div>
            <button onclick="calculate()">Analyze Inventory</button>
            <div id="results" class="results-section"></div>
            <div id="error" class="error"></div>
        </div>
        <div class="card">
            <h2>Example</h2>
            <div class="example">
                <p><strong>Sales CSV:</strong><br>stock_id,product_name,sales_amount,sales_date<br>S001,Widget A,5000,2025-06-01<br>S002,Widget B,5500,2025-06-15</p>
                <p><strong>Purchase CSV:</strong><br>stock_id,product_name,purchase_amount,purchase_date<br>S001,Widget A,4000,2025-06-01<br>S002,Widget B,4500,2025-06-15</p>
            </div>
        </div>
        <div id="feedbackSuccess" class="success-message">Thanks! Your input helps us improve StockSync!</div>
        <button class="chatbot-toggle" onclick="openChatbot()"><i class="fas fa-comment"></i></button>
    </div>
    <div id="chatbotModal" class="chatbot-modal">
        <div class="chatbot-content">
            <span class="close" onclick="closeChatbot()">×</span>
            <h2>Hi! I’m SyncMate, your inventory helper!</h2>
            <div id="chatbotMessages"></div>
            <div class="chatbot-input" id="chatbotInput"></div>
        </div>
    </div>
    <script>
        let batchSize = 200;
        let feedbackRequested = false;

        function safetyStock(dailySales, leadTime, stdDev, zScore) {
            return zScore * stdDev * Math.sqrt(leadTime) || 0;
        }

        function reorderPoint(dailySales, leadTime, safetyStock) {
            return (dailySales * leadTime) + safetyStock || 0;
        }

        function optimalOrderSize(annualDemand, orderCost, holdCost) {
            return Math.sqrt((2 * annualDemand * orderCost) / holdCost) || 0;
        }

        function processCSVFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    const rows = text.split('\n').map(row => row.split(',').map(cell => cell.trim()));
                    const headers = rows[0];
                    let data = rows.slice(1).filter(row => row.length === headers.length && row.some(cell => cell !== ''));

                    if (data.length > 1000) {
                        reject(new Error('Upload limit exceeded. Maximum 1000 records allowed.'));
                        return;
                    }

                    data = data.map(row => {
                        const obj = {};
                        const requiredHeaders = ['stock_id', 'product_name', 'sales_amount', 'sales_date'];
                        headers.forEach((header, index) => {
                            if (requiredHeaders.includes(header.toLowerCase())) {
                                obj[header] = isNaN(row[index]) ? row[index] : parseFloat(row[index]) || null;
                            }
                        });
                        return obj;
                    });
                    resolve(data);
                };
                reader.onerror = () => reject(new Error('Error reading file.'));
                reader.readAsText(file);
            });
        }

        async function preprocessData(salesData, purchaseData) {
            if (!salesData.length || !purchaseData.length) return null;

            const products = {};
            const salesDates = salesData.map(item => new Date(item.sales_date)).sort((a, b) => a - b);
            const daysActive = (salesDates[salesDates.length - 1] - salesDates[0]) / (1000 * 60 * 60 * 24) || 1;
            const annualOperatingDays = parseFloat(document.getElementById('annual_operating_days').value) || Math.min(365, daysActive);

            for (let i = 0; i < salesData.length; i += batchSize) {
                const batch = salesData.slice(i, i + batchSize);
                batch.forEach(sale => {
                    if (sale.stock_id && sale.product_name) {
                        if (!products[sale.stock_id]) products[sale.stock_id] = { name: sale.product_name, sales: [], purchases: [] };
                        products[sale.stock_id].sales.push(sale.sales_amount || 0);
                    }
                });
            }
            for (let i = 0; i < purchaseData.length; i += batchSize) {
                const batch = purchaseData.slice(i, i + batchSize);
                batch.forEach(purchase => {
                    if (purchase.stock_id && purchase.product_name) {
                        if (!products[purchase.stock_id]) products[purchase.stock_id] = { name: purchase.product_name, purchases: [] };
                        products[purchase.stock_id].purchases.push(purchase.purchase_amount || 0);
                    }
                });
            }

            const processedData = {};
            for (const [stockId, data] of Object.entries(products)) {
                const totalSales = data.sales.reduce((sum, val) => sum + (val || 0), 0);
                const dailySales = totalSales / daysActive || 0;
                const stdDev = data.sales.length > 1 ? Math.sqrt(data.sales.reduce((sum, val) => sum + Math.pow(val - dailySales, 2), 0) / data.sales.length) / Math.sqrt(daysActive) : dailySales * 0.2 || 0;
                const totalPurchases = data.purchases.reduce((sum, val) => sum + (val || 0), 0);
                const purchaseDates = purchaseData.filter(p => p.stock_id === stockId).map(p => new Date(p.purchase_date)).sort((a, b) => a - b);
                const leadTime = purchaseDates.length > 1 ? Math.round((purchaseDates[purchaseDates.length - 1] - purchaseDates[0]) / (1000 * 60 * 60 * 24) / (purchaseDates.length - 1)) : 7 || 0;
                const orderCost = totalPurchases / data.purchases.length * 0.1 || 100;
                const unitCost = totalPurchases / totalSales || 200;
                const serviceReliability = parseFloat(document.getElementById('service_reliability').value) || 1.28;

                processedData[stockId] = {
                    product_name: data.name,
                    daily_sales: dailySales,
                    lead_time: leadTime,
                    service_reliability: serviceReliability,
                    annual_operating_days: annualOperatingDays,
                    order_cost: orderCost,
                    unit_cost: unitCost,
                    std_dev: stdDev
                };
            }

            return processedData;
        }

        function calculate() {
            const errorDiv = document.getElementById('error');
            const resultsDiv = document.getElementById('results');
            errorDiv.textContent = '';
            resultsDiv.style.display = 'none';
            resultsDiv.innerHTML = '';

            const salesFile = document.getElementById('uploadSales').files[0];
            const purchaseFile = document.getElementById('uploadPurchases').files[0];

            if (!salesFile || !purchaseFile) {
                errorDiv.textContent = 'Please upload both sales and purchase sheets.';
                return;
            }

            Promise.all([processCSVFile(salesFile), processCSVFile(purchaseFile)])
                .then(async ([salesData, purchaseData]) => {
                    const processedData = await preprocessData(salesData, purchaseData);
                    if (!processedData || Object.keys(processedData).length === 0) throw new Error('No valid data to process.');
                    calculateResults(processedData);
                })
                .catch(err => {
                    errorDiv.textContent = err.message;
                });
        }

        function calculateResults(processedData) {
            const errorDiv = document.getElementById('error');
            const resultsDiv = document.getElementById('results');
            const storedData = { inputs: {}, outputs: {} };

            resultsDiv.innerHTML = '';
            resultsDiv.style.display = 'block';

            for (const [stockId, data] of Object.entries(processedData)) {
                const ss = safetyStock(data.daily_sales, data.lead_time, data.std_dev, data.service_reliability);
                const rop = reorderPoint(data.daily_sales, data.lead_time, ss);
                const orderQty = optimalOrderSize(data.daily_sales * data.annual_operating_days, data.order_cost, data.unit_cost * 0.25);
                const decisionRules = [
                    { condition: rop > orderQty * 1.2, message: `Increase your order size for ${data.product_name} to avoid frequent reordering.` },
                    { condition: ss < data.daily_sales * 0.15, message: `Boost service reliability for ${data.product_name} as safety stock is low.` },
                    { condition: orderQty < data.daily_sales * 1.5, message: `Check costs or demand for ${data.product_name} as order size seems small.` }
                ];
                const decision = decisionRules.find(rule => rule.condition)?.message || `You're on track with ${data.product_name}'s inventory!`;

                storedData.inputs[stockId] = { ...data };
                storedData.outputs[stockId] = { safetyStock: ss, reorderPoint: rop, optimalOrderSize: orderQty, decision };

                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                resultCard.innerHTML = `
                    <h3>${data.product_name} (Stock ID: ${stockId})</h3>
                    <p>For ${data.product_name}, keep a safety stock of ${ss.toFixed(2)} units to handle unexpected demand.</p>
                    <p>Plan to reorder ${data.product_name} when stock drops to ${rop.toFixed(2)} units to prevent shortages.</p>
                    <p>Order ${data.product_name} in batches of ${orderQty.toFixed(2)} units to keep costs low.</p>
                    <p><strong>Smart Tip:</strong> ${decision}</p>
                `;

                const chartDiv = document.createElement('div');
                chartDiv.className = 'chart-container';
                chartDiv.innerHTML = `
                    <div class="chart">
                        <div class="chart-title">Insights for ${data.product_name}</div>
                        <svg viewBox="0 0 400 360">
                            <line x1="50" y1="320" x2="350" y2="320" stroke="#000" stroke-width="1"/>
                            <line x1="50" y1="40" x2="50" y2="320" stroke="#000" stroke-width="1"/>
                            <g><line x1="100" y1="320" x2="100" y2="${320 - (ss / Math.max(ss, rop, orderQty) * 280)}" stroke="#2b6cb0" stroke-width="2"/><circle cx="100" cy="${320 - (ss / Math.max(ss, rop, orderQty) * 280)}" r="3" fill="#2b6cb0"/><text x="100" y="330" font-size="9" text-anchor="middle">Safety</text></g>
                            <g><line x1="200" y1="320" x2="200" y2="${320 - (rop / Math.max(ss, rop, orderQty) * 280)}" stroke="#e53e3e" stroke-width="2"/><circle cx="200" cy="${320 - (rop / Math.max(ss, rop, orderQty) * 280)}" r="3" fill="#e53e3e"/><text x="200" y="330" font-size="9" text-anchor="middle">Reorder</text></g>
                            <g><line x1="300" y1="320" x2="300" y2="${320 - (orderQty / Math.max(ss, rop, orderQty) * 280)}" stroke="#38a169" stroke-width="2"/><circle cx="300" cy="${320 - (orderQty / Math.max(ss, rop, orderQty) * 280)}" r="3" fill="#38a169"/><text x="300" y="330" font-size="9" text-anchor="middle">Order</text></g>
                            <text x="45" y="150" font-size="9" transform="rotate(-90 45 150)">Units</text>
                        </svg>
                        <legend>Guide: Safety (Blue), Reorder (Red), Order (Green) levels</legend>
                    </div>
                `;
                resultCard.appendChild(chartDiv);
                resultsDiv.appendChild(resultCard);
            }

            window.storedInventoryData = storedData;
            const jsonData = JSON.stringify(storedData);
            console.log('Stored Data for Training:', jsonData);
        }

        function checkInputs() {
            const salesFile = document.getElementById('uploadSales').files[0];
            const purchaseFile = document.getElementById('uploadPurchases').files[0];
            const serviceReliability = document.getElementById('service_reliability').value;
            const annualOperatingDays = document.getElementById('annual_operating_days').value;

            if (!feedbackRequested && (salesFile || purchaseFile || serviceReliability || annualOperatingDays)) {
                feedbackRequested = true;
                openChatbotWithRequest();
            }
        }

        function openChatbotWithRequest() {
            document.getElementById('chatbotModal').style.display = 'flex';
            const messages = document.getElementById('chatbotMessages');
            const input = document.getElementById('chatbotInput');
            messages.innerHTML = '<div class="chatbot-message">Hey! I’m SyncMate, your inventory helper! As you start, could you share how we can improve StockSync for you?</div>';
            input.innerHTML = `
                <button onclick="chatResponse('Yes, it helped a lot!')">Yes, it helped a lot!</button>
                <button onclick="chatResponse('It was okay')">It was okay</button>
                <button onclick="chatResponse('No, I struggled')">No, I struggled</button>
            `;
        }

        function openChatbot() {
            if (!feedbackRequested) {
                openChatbotWithRequest();
            } else {
                document.getElementById('chatbotModal').style.display = 'flex';
                const messages = document.getElementById('chatbotMessages');
                const input = document.getElementById('chatbotInput');
                messages.innerHTML = '<div class="chatbot-message">Hey! I’m SyncMate, your inventory helper! Did you find StockSync useful today?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('Yes, it helped a lot!')">Yes, it helped a lot!</button>
                    <button onclick="chatResponse('It was okay')">It was okay</button>
                    <button onclick="chatResponse('No, I struggled')">No, I struggled</button>
                `;
            }
        }

        function chatResponse(response) {
            const messages = document.getElementById('chatbotMessages');
            messages.innerHTML += `<div class="chatbot-message">You said: ${response}</div>`;
            const input = document.getElementById('chatbotInput');

            if (response.includes('helped')) {
                messages.innerHTML += '<div class="chatbot-message">Glad to hear that! What did you like best about it?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('The charts')">The charts</button>
                    <button onclick="chatResponse('The tips')">The tips</button>
                    <button onclick="chatResponse('How easy it was')">How easy it was</button>
                `;
            } else if (response.includes('okay')) {
                messages.innerHTML += '<div class="chatbot-message">Thanks for sharing! What could we make better for you?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('Make it faster')">Make it faster</button>
                    <button onclick="chatResponse('Clearer instructions')">Clearer instructions</button>
                    <button onclick="chatResponse('Better design')">Better design</button>
                `;
            } else if (response.includes('struggled')) {
                messages.innerHTML += '<div class="chatbot-message">Sorry to hear that! What gave you trouble?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('Uploading files')">Uploading files</button>
                    <button onclick="chatResponse('The calculations')">The calculations</button>
                    <button onclick="chatResponse('Something else')">Something else</button>
                `;
            } else if (response.includes('charts') || response.includes('tips') || response.includes('easy')) {
                messages.innerHTML += '<div class="chatbot-message">Nice! What new tool would help you manage inventory better?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('Sales forecasts')">Sales forecasts</button>
                    <button onclick="chatResponse('Stock alerts')">Stock alerts</button>
                    <button onclick="chatResponse('More reports')">More reports</button>
                `;
            } else if (response.includes('faster') || response.includes('instructions') || response.includes('design')) {
                messages.innerHTML += '<div class="chatbot-message">Got it! What new feature could solve your biggest challenge?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('A mobile version')">A mobile version</button>
                    <button onclick="chatResponse('Auto updates')">Auto updates</button>
                    <button onclick="chatResponse('Team access')">Team access</button>
                `;
            } else if (response.includes('files') || response.includes('calculations') || response.includes('else')) {
                messages.innerHTML += '<div class="chatbot-message">Let’s fix that! What would make your day easier?</div>';
                input.innerHTML = `
                    <button onclick="chatResponse('A help guide')">A help guide</button>
                    <button onclick="chatResponse('Quick support')">Quick support</button>
                    <button onclick="chatResponse('Step-by-step tips')">Step-by-step tips</button>
                `;
            } else {
                submitChatResponse(response);
            }
        }

        function submitChatResponse(finalResponse) {
            const messages = document.getElementById('chatbotMessages');
            messages.innerHTML += '<div class="chatbot-message">Thanks a bunch! I’ll pass this to the team to make StockSync even better for you.</div>';
            document.getElementById('chatbotInput').innerHTML = '';

            const feedbackData = {
                response: finalResponse,
                timestamp: new Date().toISOString()
            };
            const encodedData = btoa(JSON.stringify(feedbackData));
            console.log('Chatbot Feedback:', encodedData);

            fetch('https://script.google.com/macros/s/AKfycbwRb5mL5c9hivpQiLnrf1ZGHNZpkj3ch8zOg5xInCpbTUzhwOPLvPTTBJL9LnzR-OOZ/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ encodedData })
            })
            .then(() => {
                document.getElementById('feedbackSuccess').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('feedbackSuccess').style.display = 'none';
                    closeChatbot();
                }, 3000);
            })
            .catch(error => console.error('Error:', error));
        }

        function closeChatbot() {
            document.getElementById('chatbotModal').style.display = 'none';
            document.getElementById('chatbotMessages').innerHTML = '';
            document.getElementById('chatbotInput').innerHTML = '';
        }
    </script>
</body>
</html>